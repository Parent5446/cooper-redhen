<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>RedHen Spectrum Analyzer</title>
        <meta charset="utf-8" />
        <link rel='stylesheet' href='main.css' /> <!--Link to stylesheet-->
        <link rel='shortcut icon' href='favicon.ico' /> <!--Favicon for site-->
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    </head>
    <body style='text-align:center; padding:40px;'> <!--Core HTML:-->
        <div id="header"><img src='banner.png' alt="RedHen logo" /></div>
        
        <table style='margin:auto;'> <!--Layout table, holds site's pieces in order-->
        
        <tr><td rowspan='2'> <div id='graph' class='graph' onmousemove='graph_mouseover(event);' onmouseout='document.body.style.cursor="default"'></div> </td> <!--Graph of results-->   

        <td> <div class='frontpage-controls' id='controls'> <!--Main controls-->
            <table class='controls-table'>
                <tr>
                    <td><input type='button' id='browse_button' value='Browse' class='button' /></td>
                    <td><select id='browse_options' class='listbox'>
                        <option>my computer</option>
                        <option>my projects</option>
                        <option>main library</option>
                    </select></td>
                </tr>
                <tr>
                    <td><input type='button' id='compare_button' value='Compare' class='button' /></td>
                    <td><select id='compare_options' class='listbox'>
                        <option>to main library</option>
                        <option>to my projects</option>
                        <option>to each other</option>
                    </select></td>
                </tr>
            </table>

            <iframe class='invisible-frame' scrolling="no" id='file_frame' src='file_upload_frame.html'></iframe>
            
            <div class='browse-dialog' id='browse_dialog'> <!--Browse dialog, usually invisible-->
                Enter a chemical name to search:
                <input type='text' class='combobox-text' id='combobox_text' />
                <div class='combobox-dropdown' id='combobox_dropdown' onmouseover='document.body.style.cursor="pointer";' onmouseout='document.body.style.cursor="default";'></div>
                <input type='button' value='Done' id='done_button' />
            </div>
        </div> </td></tr> <!--End of main controls-->
        
        <tr><td> <div id='results' class='results'></div> <!--List of results-->
        </td></tr> </table> <!--End of layout table-->
        
        <div id='loaded_list' class='loaded-list'></div> <!--List of loaded files-->
    
    <script type="text/javascript">
        //<!--
        $(document).ready(function() {
            session_id = Math.floor(Math.random()*1e12)+(new Date()).getTime(); //Unique ID so the server can distinguish clients
        });
            
        function file_loaded(file) {
            $('#loaded_list').css('display', 'block');
            addToLoadedList(file);
        }
        
        function unload(file) {
            $('#checkbox_'+file).css('display', 'none');
            var action = function(response) { alert('Deleted '+file+' from server.'); };
            $.ajax({ url: '/api', success: action });
        }
        
        function addToLoadedList(s) {
            var id = String(s).replace('.','_');
            $('#loaded_list').append('<div id="checkbox_'+id+'"><input type="checkbox" checked onclick="unload(\''+id+'\')"> '+s+'</div>');
        }
         
        function combobox_clicked(text) {
            $('#combobox_text').val(text);
            $('#combobox_dropdown').css('display', 'none');
            $('#combobox_text').focus();
        }
        
        $('#browse_button').click(function() {
            var selected = $('#browse_options option:selected').val();
            $('#browse_dialog').css('display', 'block');
            $('#combobox_text').focus();
        });
        
        $('#compare_button').click(function() {
            var selected = $('#compare_options option:selected').val();
            $('#loaded_list').css('display', 'none');
            $('body').css('padding', '0px');
            $('#graph').css('display', 'block');
            $('#results').css('display', 'block');
            $('#results').html('Getting results...');
            var got_results = function(response) {
                $('#results').html(response);
                $('#graph').data = Array();
                var vertical_divs = Array();
                for(var x=0; x<$('#graph').width(); x++) { 
                    $('#graph').data[x] = Math.floor(Math.random()*20) + x/2;
                    vertical_divs.push('<div class="graph-line" style="left:'+x+'px; height:'+$('#graph').data[x]+'px;"></div>');
                }
                vertical_divs.push('<div id="floatybar" class="graph-floatybar">0,0</div>');
                $('#graph').html(vertical_divs.join(''));
            };
            $.ajax({ url: '/api', success: got_results });
        });
        
        function graph_mouseover(e, x) {
            document.body.style.cursor="crosshair";
            var x = e.pageX - $('#graph').position().left;
            var y = e.pageY - $('#graph').position().top;
            $('#floatybar').css('left', x);
            $('#floatybar').css('top', y);
            $('#floatybar').html(x+', '+$('#graph').data[x]);
            $('#floatybar').css('display', 'block');
        }
        
        $('#browse_options').change(function() {
            //Make file upload frame go away when not selected
            var selected = $('#browse_options option:selected').val();
            if(selected == 'my computer') {
                $('#file_frame').css('display', 'block');
            } else {
                $('#file_frame').css('display', 'none');
            }
        });
        
        $('#done_button').click(function() {
            $('#browse_dialog').css('display', 'none');
            addToLoadedList($('#combobox_text').val());
            $('#combobox_text').val('');
            $('#combobox_dropdown').css('display', 'none');
            $('#combobox_dropdown').html('');
        });
        
        $('#combobox_text').keyup(function(key) {
            var unicode = key.keyCode ? key.keyCode : key.charCode;
            if(unicode==13) $('#done_button').click();
            if($('#combobox_text').val().length<4) return;
            $('#combobox_dropdown').load( '/api', $('#combobox_text').val() )
            $('#combobox_dropdown').css('display', 'block');
        });
       //-->
    </script>
    </body>
</html>
